/*
 * pwm1_4_pf2.c
 *
 *  Created on: Jul 27, 2023
 *      Author: Phong
 */

#include "TM4C123GH6PM.h"

void clockSetting(){
    /* Clock setting for PWM and GPIO PORT */
    SYSCTL->RCGCPWM |= (1U << 1);       /* Enable clock to PWM1 module */
    SYSCTL->RCGCGPIO |= (1U << 5);   /* Enable system clock to PORTF */
    SYSCTL->RCC &= ~(1U << 20); /* Directly feed clock to PWM1 module without pre-divider */
}

void pwmOutputPin(){
    /* Setting of PF2 pin for M1PWM6 channel output pin */
    GPIOF->AFSEL |= (1U << 2);     /* PF2 sets a alternate function */
    GPIOF->AFSEL |= (1U << 3);

    GPIOF->PCTL &= ~(0b1111 << 8); /*set PF2 as output pin */
    GPIOF->PCTL &= ~(0b1111 << 12);
    GPIOF->PCTL |= (0x5) << 8; /* make PF2 PWM output pin */
    GPIOF->PCTL |= (0x5) << 12;

    GPIOF->DEN |= (1U << 2);      /* set PF2 as a digital pin */
    GPIOF->DEN |= (1U << 3);
}

void pwmSetting(){
    /* PWM1 channel 6 setting */
    PWM1->_3_CTL &= ~(1<<0);   /* Disable Generator 3 counter */    /* page 1266 */
    PWM1->_3_CTL &= ~(1<<1);   /* select down count mode of counter 3*/

    PWM1->_3_GENA |= (1U << 7) /*(0x0000008C)*/; /* Set PWM output when counter reloaded and clear when matches PWMCMPA */
    PWM1->_3_GENA |= (0x3 << 2);

    PWM1->_3_GENB |= (1U << 7);
    PWM1->_3_GENB |= (0x2 << 2);

    PWM1->_3_LOAD = 16000;   /* set load value for 1kHz (16MHz/16000) */
    PWM1->_3_CMPA = 8000 - 1;  /* set duty cyle to 50% by loading of 16000 to PWM1CMPA */

    PWM1->_3_CMPB = 8000 -1;
}

void pwmEnable(){
    PWM1->_3_CTL |= 1U;         /* Enable Generator 3 counter */
    PWM1->ENABLE |= (1U << 6) | (1U << 7);      /* Enable PWM1 channel 6 output */
}

void pwmPE4(){
    /* Clock setting for PWM and GPIO PORT */
    //SYSCTL->RCGC0 |= (1U << 20);    /* page 456 */
    SYSCTL->RCGCPWM |= (1U << 0);       /* Enable clock to PWM1 module */ /*page 354*/
    SYSCTL->RCGCGPIO |= (1U << 4);   /* Enable system clock to PORTE */ /*page 406*/
    SYSCTL->RCC &= ~(1U << 20); /* Directly feed clock to PWM0 module without pre-divider */    /* page 254 */

    /* Setting of PE4 pin for M0PWM4 channel output pin */
    GPIOE->AFSEL |= (1 << 4);     /* PE4 sets a alternate function */ /* page 671 */
    GPIOE->PCTL &= ~(0b1111 << 16); /*set PE4 as output pin */ /* page 688 */
    GPIOE->PCTL |= (0x4) << 16; /* make PE4 PWM output pin */
    GPIOE->DEN |= (1U << 4);      /* set PE4 as a digital pin */ /* page 682 */

    /* PWM1 channel 6 setting */
    PWM0->_2_CTL &= ~(1U<<0);   /* Disable Generator 2 counter */
    PWM0->_2_CTL &= ~(1U<<1);   /* select down count mode of counter 2*/
    PWM0->_2_GENA = (1U << 7) | (0x3 << 2) /*(0x0000008C)*/; /* Set PWM output when counter reloaded and clear when matches PWMCMPA */
    PWM0->_2_LOAD = 16000;   /* set load value for 1kHz (16MHz/16000) */
    PWM0->_2_CMPA = 8000-1;  /* set duty cyle to 50% by loading of 16000 to PWM0CMPA */
    PWM0->_2_CTL = 1U;         /* Enable Generator 2 counter */
    PWM0->ENABLE = (1U << 4);      /* Enable PWM0 channel 4 output */
}
